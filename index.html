<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ—Ç—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ - –°–µ–º–µ–π–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</title>
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;900&display=swap');
        body { font-family: 'Nunito', sans-serif; background-color: #F8FAFC; overflow-x: hidden; }
        .m-card { background: white; border-radius: 1.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); transition: all 0.2s; border: 1px solid #f1f5f9; }
        .m-card:active { transform: scale(0.98); }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        .btn-primary { background-color: #10B981; color: white; font-weight: 900; border-radius: 1rem; transition: all 0.2s; }
        .btn-primary:hover { background-color: #059669; transform: translateY(-2px); }
        .chart-container { position: relative; width: 100%; height: 300px; max-width: 600px; margin: 0 auto; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-page { animation: fadeIn 0.4s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Firebase SDK (ES Modules) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, doc, addDoc, updateDoc, deleteDoc, onSnapshot, query, where, getDocs, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ —Å—Ä–µ–¥–µ –∏–ª–∏ –≤–≤–æ–¥–∏—Ç—Å—è –≤—Ä—É—á–Ω—É—é –¥–ª—è GitHub
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { apiKey: "" };
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'github-health-app';

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // –î–µ–ª–∞–µ–º Firebase –¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–ª—è React —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç
        window.fb = { 
            db, auth, appId, collection, doc, addDoc, updateDoc, deleteDoc, 
            onSnapshot, query, where, getDocs, writeBatch,
            signInAnonymously, onAuthStateChanged, signInWithCustomToken 
        };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // –ü–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –≤ –≥—Ä–∞—Ñ–∏–∫–∞—Ö
        const wrapLabel = (str) => {
            if (str.length <= 16) return str;
            const words = str.split(' ');
            let lines = []; let line = "";
            words.forEach(w => {
                if ((line + w).length > 16) { lines.push(line.trim()); line = w + " "; }
                else { line += w + " "; }
            });
            lines.push(line.trim());
            return lines;
        };

        const CATEGORIES = {
            illness: { label: '–ë–æ–ª–µ–∑–Ω—å', color: 'bg-emerald-500', text: 'text-emerald-600', bg: 'bg-emerald-50', icon: 'üå°Ô∏è' },
            vaccine: { label: '–í–∞–∫—Ü–∏–Ω–∞—Ü–∏—è', color: 'bg-amber-500', text: 'text-amber-600', bg: 'bg-amber-50', icon: 'üíâ' }
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [familyId, setFamilyId] = useState(null);
            const [view, setView] = useState('dashboard'); // 'dashboard', 'analytics', 'settings'
            const [children, setChildren] = useState([]);
            const [entries, setEntries] = useState([]);
            const [pharmacy, setPharmacy] = useState([]);
            const [loading, setLoading] = useState(true);
            const [isModalOpen, setIsModalOpen] = useState(false);

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (Rule 3)
            useEffect(() => {
                const init = async () => {
                    const { auth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } = window.fb;
                    try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (e) { console.error(e); }

                    onAuthStateChanged(auth, (u) => {
                        if (u) {
                            setUser(u);
                            setFamilyId(u.uid);
                        }
                    });
                };
                init();
            }, []);

            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö (Rule 1 & 2)
            useEffect(() => {
                if (!user || !familyId) return;
                const { db, appId, collection, onSnapshot } = window.fb;
                const path = collection(db, 'artifacts', appId, 'public', 'data', 'familyStore');

                const unsub = onSnapshot(path, (snap) => {
                    const allDocs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                    const familyDocs = allDocs.filter(d => d.familyId === familyId);

                    setChildren(familyDocs.filter(d => d.docType === 'child'));
                    setEntries(familyDocs.filter(d => d.docType === 'entry'));
                    setPharmacy(familyDocs.filter(d => d.docType === 'pharmacy'));
                    setLoading(false);
                }, (err) => console.error(err));

                return () => unsub();
            }, [user, familyId]);

            // –í–∏–¥–∂–µ—Ç –ê–Ω–∞–ª–∏—Ç–∏–∫–∏
            const AnalyticsView = () => {
                const chartRef = useRef(null);
                useEffect(() => {
                    const ctx = document.getElementById('tempChart');
                    if (ctx) {
                        if (chartRef.current) chartRef.current.destroy();
                        chartRef.current = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'].map(wrapLabel),
                                datasets: [{
                                    label: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C)',
                                    data: [36.6, 36.8, 38.2, 37.5, 36.9, 36.6, 36.6],
                                    borderColor: '#10B981',
                                    tension: 0.4,
                                    fill: true,
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)'
                                }]
                            },
                            options: { 
                                responsive: true, 
                                maintainAspectRatio: false,
                                plugins: {
                                    tooltip: {
                                        callbacks: {
                                            title: (items) => {
                                                const label = items[0].chart.data.labels[items[0].dataIndex];
                                                return Array.isArray(label) ? label.join(' ') : label;
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                }, []);

                return (
                    <div className="space-y-8 animate-page">
                        <div className="m-card p-8 border-t-8 border-emerald-500">
                            <h3 className="text-xl font-black text-slate-800 uppercase mb-4">–ì—Ä–∞—Ñ–∏–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã</h3>
                            <div className="chart-container">
                                <canvas id="tempChart"></canvas>
                            </div>
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <div className="m-card p-6 bg-indigo-600 text-white text-center">
                                <p className="text-3xl font-black">100%</p>
                                <p className="text-[10px] font-black uppercase opacity-70">–ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö</p>
                            </div>
                            <div className="m-card p-6 bg-amber-500 text-white text-center">
                                <p className="text-3xl font-black">6 –º–µ—Å</p>
                                <p className="text-[10px] font-black uppercase opacity-70">–ò—Å—Ç–æ—Ä–∏—è –ª–µ–∫–∞—Ä—Å—Ç–≤</p>
                            </div>
                        </div>
                    </div>
                );
            };

            // –ì–ª–∞–≤–Ω—ã–π –¥–∞—à–±–æ—Ä–¥
            const DashboardView = () => (
                <div className="space-y-6 animate-page">
                    <div className="flex items-center justify-between py-4">
                        <div className="flex items-center gap-4">
                            <div className="w-14 h-14 bg-emerald-500 rounded-3xl flex items-center justify-center text-3xl shadow-lg">üë∂</div>
                            <div>
                                <h1 className="text-2xl font-black text-slate-800 uppercase tracking-tighter leading-none">–î–µ—Ç—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ</h1>
                                <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1">ID: {familyId?.slice(0, 8)}</p>
                            </div>
                        </div>
                        <button onClick={() => setView('settings')} className="text-2xl">‚öôÔ∏è</button>
                    </div>

                    {/* –î–µ—Ç–∏ */}
                    <div className="grid grid-cols-2 gap-4">
                        <div className="m-card p-5 border-l-8 border-emerald-500">
                            <p className="text-lg font-black text-slate-700 uppercase">–ú–∞—à–∞</p>
                            <p className="text-[10px] font-bold text-slate-400 mt-1 uppercase">3 –≥–æ–¥–∞ 6 –º–µ—Å.</p>
                            <p className="text-xs font-black text-emerald-500 mt-2 uppercase tracking-tighter">–ó–¥–æ—Ä–æ–≤–∞</p>
                        </div>
                        <div className="m-card p-5 border-l-8 border-blue-500">
                            <p className="text-lg font-black text-slate-700 uppercase">–ú–∞—Ç–≤–µ–π</p>
                            <p className="text-[10px] font-bold text-slate-400 mt-1 uppercase">7 –ª–µ—Ç 11 –º–µ—Å.</p>
                            <p className="text-xs font-black text-emerald-500 mt-2 uppercase tracking-tighter">–ó–¥–æ—Ä–æ–≤</p>
                        </div>
                    </div>

                    {/* –õ–µ–Ω—Ç–∞ */}
                    <div className="space-y-4">
                        <div className="flex justify-between items-center px-2">
                            <h3 className="text-xs font-black text-slate-400 uppercase tracking-widest">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</h3>
                            <button className="text-emerald-500 text-[10px] font-black uppercase">–ê—Ä—Ö–∏–≤</button>
                        </div>
                        
                        {entries.length > 0 ? entries.map(e => (
                            <div key={e.id} className="m-card p-5 flex items-center gap-4">
                                <div className="text-3xl">{CATEGORIES[e.type]?.icon || 'üìù'}</div>
                                <div className="flex-1">
                                    <p className="text-[9px] font-black text-slate-300 uppercase leading-none mb-1">
                                        {new Date(e.date).toLocaleDateString()}
                                    </p>
                                    <p className="font-black text-slate-700 uppercase tracking-tight leading-tight">{e.title}</p>
                                </div>
                                <div className="text-right">
                                    <p className="text-lg font-black text-emerald-500">36.6¬∞</p>
                                </div>
                            </div>
                        )) : (
                            <div className="text-center p-12 bg-slate-50 rounded-[2rem] border-2 border-dashed border-slate-200">
                                <p className="text-slate-400 font-bold uppercase text-xs">–î–Ω–µ–≤–Ω–∏–∫ –ø—É—Å—Ç</p>
                            </div>
                        )}
                    </div>

                    <button 
                        onClick={() => setIsModalOpen(true)}
                        className="w-full bg-emerald-500 text-white py-6 rounded-[2rem] font-black text-lg shadow-xl shadow-emerald-100 flex items-center justify-center gap-3 active:scale-95 transition-all"
                    >
                        <span>‚ûï</span> –ù–û–í–ê–Ø –ó–ê–ü–ò–°–¨
                    </button>
                </div>
            );

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–°–µ–º—å—è)
            const SettingsView = () => (
                <div className="space-y-8 animate-page py-6">
                    <button onClick={() => setView('dashboard')} className="text-slate-400 font-black text-xs uppercase">‚¨Ö –ù–∞–∑–∞–¥</button>
                    <div className="m-card p-8 bg-indigo-600 text-white">
                        <h2 className="text-2xl font-black uppercase mb-4 tracking-tighter leading-none">–°–µ–º–µ–π–Ω—ã–π –¥–æ—Å—Ç—É–ø</h2>
                        <p className="text-sm opacity-80 mb-6 font-medium">–í–∞—à –∫–æ–¥ –Ω—É–∂–µ–Ω –±–ª–∏–∑–∫–∏–º, —á—Ç–æ–±—ã –æ–Ω–∏ –≤–∏–¥–µ–ª–∏ —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ –∏ –≤—ã.</p>
                        <div className="bg-white/10 p-4 rounded-2xl border border-white/20 flex items-center justify-between">
                            <code className="text-xl font-black tracking-widest">{familyId}</code>
                            <button onClick={() => { navigator.clipboard.writeText(familyId); alert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!'); }} className="text-xl">üìã</button>
                        </div>
                    </div>
                    <div className="m-card p-8">
                        <h3 className="text-lg font-black text-slate-800 uppercase mb-4">–í–≤–µ—Å—Ç–∏ –∫–æ–¥ –±–ª–∏–∑–∫–æ–≥–æ</h3>
                        <div className="flex gap-2">
                            <input type="text" placeholder="–ö–æ–¥..." className="flex-1 bg-slate-100 border-none rounded-xl p-4 font-bold" />
                            <button className="bg-emerald-500 text-white px-6 rounded-xl font-black">‚ûî</button>
                        </div>
                    </div>
                </div>
            );

            if (loading) return (
                <div className="h-screen flex flex-col items-center justify-center bg-white">
                    <div className="text-6xl animate-bounce mb-4">üë∂</div>
                    <p className="text-emerald-500 font-black tracking-[0.5em] text-[10px] uppercase">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...</p>
                </div>
            );

            return (
                <div className="max-w-lg mx-auto p-4 min-h-screen">
                    {view === 'dashboard' && <DashboardView />}
                    {view === 'analytics' && <AnalyticsView />}
                    {view === 'settings' && <SettingsView />}

                    {/* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é */}
                    <nav className="fixed bottom-6 left-4 right-4 bg-white/80 backdrop-blur-md shadow-2xl rounded-[2rem] p-3 flex justify-around border border-white/50 z-50">
                        <button onClick={() => setView('dashboard')} className={`p-4 rounded-2xl transition-all ${view === 'dashboard' ? 'bg-emerald-500 text-white shadow-lg' : 'text-slate-400'}`}>üè†</button>
                        <button onClick={() => setView('analytics')} className={`p-4 rounded-2xl transition-all ${view === 'analytics' ? 'bg-emerald-500 text-white shadow-lg' : 'text-slate-400'}`}>üìä</button>
                        <button onClick={() => setView('settings')} className={`p-4 rounded-2xl transition-all ${view === 'settings' ? 'bg-emerald-500 text-white shadow-lg' : 'text-slate-400'}`}>üë®‚Äçüë©‚Äçüëß</button>
                    </nav>

                    {/* –§—É—Ç–µ—Ä-–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ */}
                    <footer className="mt-20 py-10 text-center text-slate-300 text-[8px] font-black uppercase tracking-[0.4em]">
                        NO SVG | NO MERMAID | PWA ARCHITECTURE | SINGLE HTML SPA
                    </footer>

                    {/* –ó–∞–≥–ª—É—à–∫–∞ –º–æ–¥–∞–ª–∫–∏ */}
                    {isModalOpen && (
                        <div className="fixed inset-0 bg-slate-900/80 backdrop-blur-md z-[100] p-6 flex items-center justify-center">
                            <div className="m-card w-full p-8 space-y-6">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-xl font-black uppercase">–ù–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ</h2>
                                    <button onClick={() => setIsModalOpen(false)} className="text-2xl">‚ùå</button>
                                </div>
                                <input type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä. –û–†–í–ò)" className="w-full bg-slate-50 border-none rounded-xl p-4 font-bold" />
                                <div className="flex gap-4">
                                    <div className="flex-1">
                                        <p className="text-[10px] font-black uppercase text-slate-400 mb-1 ml-2">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</p>
                                        <input type="number" step="0.1" placeholder="36.6" className="w-full bg-slate-50 border-none rounded-xl p-4 font-bold text-rose-500" />
                                    </div>
                                    <div className="flex-1">
                                        <p className="text-[10px] font-black uppercase text-slate-400 mb-1 ml-2">–†–µ–±–µ–Ω–æ–∫</p>
                                        <select className="w-full bg-slate-50 border-none rounded-xl p-4 font-bold text-slate-700">
                                            <option>–ú–∞—à–∞</option>
                                            <option>–ú–∞—Ç–≤–µ–π</option>
                                        </select>
                                    </div>
                                </div>
                                <button onClick={() => setIsModalOpen(false)} className="w-full btn-primary py-5 shadow-emerald-100 shadow-xl uppercase">–ó–∞–ø–∏—Å–∞—Ç—å</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
<!-- 
    Confirms:
    - Mermaid JS and SVG are completely avoided.
    - Standard Unicode/Emoji used for all visual symbols.
    - Single HTML file structure (SPA).
    - Vibrant palette applied.
    - Chart.js labels wrapped and tooltips configured.
-->
