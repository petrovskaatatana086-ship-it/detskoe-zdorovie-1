<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <title>–î–µ—Ç—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#34C759">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="–î–µ—Ç—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="–î–µ—Ç—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ">
    <meta name="msapplication-TileColor" content="#34C759">
    
    <!-- –ò–∫–æ–Ω–∫–∏ –¥–ª—è PWA (—ç–º–æ–¥–∂–∏ –∫–∞–∫ –∏–∫–æ–Ω–∫–∞) -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%2334C759'/%3E%3Ctext x='50' y='70' font-size='60' text-anchor='middle' fill='white' font-family='Arial'%3Eüë∂%3C/text%3E%3C/svg%3E">
    <link rel="icon" type="image/png" sizes="192x192" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%2334C759'/%3E%3Ctext x='50' y='70' font-size='60' text-anchor='middle' fill='white' font-family='Arial'%3Eüë∂%3C/text%3E%3C/svg%3E">
    
    <!-- –ú–∞–Ω–∏—Ñ–µ—Å—Ç –¥–ª—è PWA -->
    <link rel="manifest" href="data:application/manifest+json,%7B%22name%22%3A%22%D0%94%D0%B5%D1%82%D1%81%D0%BA%D0%BE%D0%B5%20%D0%B7%D0%B4%D0%BE%D1%80%D0%BE%D0%B2%D1%8C%D0%B5%22%2C%22short_name%22%3A%22%D0%97%D0%B4%D0%BE%D1%80%D0%BE%D0%B2%D1%8C%D0%B5%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23F2F2F7%22%2C%22theme_color%22%3A%22%2334C759%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22data:image/svg+xml,%253Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%253E%253Ccircle cx='50' cy='50' r='45' fill='%252334C759'/%253E%253Ctext x='50' y='70' font-size='60' text-anchor='middle' fill='white' font-family='Arial'%253E%25F0%259F%2591%25B6%253C/text%253E%253C/svg%253E%22%2C%22sizes%22%3A%22192x192%22%2C%22type%22%3A%22image/svg+xml%22%7D%5D%7D">
    
    <style>
        /* CSS Variables - –ª–µ–≥–∫–∞—è —Å–º–µ–Ω–∞ —Ü–≤–µ—Ç–æ–≤ */
        :root {
            --primary: #34C759;
            --primary-light: #E5F5E8;
            --primary-dark: #2B8540;
            --secondary: #FF9F0A;
            --secondary-light: #FFF3E0;
            --danger: #FF3B30;
            --danger-light: #FFEBEE;
            --text: #1C1C1E;
            --text-secondary: #8E8E93;
            --background: #F2F2F7;
            --card-bg: rgba(255, 255, 255, 0.9);
            --border: rgba(60, 60, 67, 0.08);
            --glass: rgba(255, 255, 255, 0.7);
            --recovery: #5856D6;
            --recovery-light: #EDEDFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--background);
            color: var(--text);
            padding: 12px;
            min-height: 100vh;
        }

        .app {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç —Å—Ç–µ–∫–ª–∞ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ */
        .glass-header {
            background: var(--glass);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 14px;
            padding: 16px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.3px;
            color: var(--text);
        }

        h2 {
            font-size: 20px;
            font-weight: 600;
            letter-spacing: -0.3px;
            margin-bottom: 12px;
        }

        h3 {
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-secondary);
        }

        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –¥–µ—Ç–µ–π */
        .children-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            overflow-x: auto;
            padding: 4px 0;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .children-selector::-webkit-scrollbar {
            display: none;
        }

        .child-item {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 30px;
            padding: 4px 4px 4px 16px;
            border: 1px solid var(--border);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.02);
            flex-shrink: 0;
            min-height: 44px;
        }

        .child-btn {
            padding: 8px 12px;
            border: none;
            background: none;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            min-height: 44px;
        }

        .child-btn.active {
            color: var(--primary);
        }

        .child-btn.all-btn {
            color: var(--secondary);
        }

        .child-btn.all-btn.active {
            color: var(--secondary);
            font-weight: 600;
        }

        .edit-child-btn, .delete-child-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            background: transparent;
            transition: all 0.2s;
            min-height: 40px;
            min-width: 40px;
        }

        .edit-child-btn:hover, .delete-child-btn:hover {
            background: var(--background);
        }

        .add-child-btn {
            padding: 12px 20px;
            border: 1px dashed var(--primary);
            border-radius: 30px;
            background: white;
            color: var(--primary);
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
            min-height: 44px;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 20px;
            padding: 20px;
            color: white;
            margin-bottom: 12px;
            box-shadow: 0 8px 20px rgba(52, 199, 89, 0.3);
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 16px;
            font-weight: 500;
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
            font-weight: 400;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 600;
            margin-top: 4px;
        }

        /* –°—Ç—Ä–æ–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–±–µ–Ω–∫–∞ –≤ —Ä–µ–∂–∏–º–µ "–í—Å–µ" */
        .child-stats-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        }

        .child-stats-row:last-child {
            border-bottom: none;
        }

        .child-name {
            font-weight: 600;
            font-size: 15px;
            min-width: 70px;
        }

        .child-stat-items {
            display: flex;
            flex: 1;
            justify-content: space-around;
            text-align: center;
            gap: 4px;
        }

        .child-stat {
            flex: 1;
            font-size: 13px;
        }

        .child-stat-label {
            font-size: 10px;
            opacity: 0.7;
            margin-bottom: 2px;
        }

        /* –ü–ª–∞–Ω–æ–≤—ã–µ –ø—Ä–∏–≤–∏–≤–∫–∏ */
        .planned-vaccines {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border-radius: 14px;
            padding: 12px;
            margin-top: 12px;
        }

        .planned-vaccine-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
        }

        .planned-vaccine-item:last-child {
            border-bottom: none;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –±–æ–ª–µ–∑–Ω–∏ */
        .illness-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.02);
        }

        .illness-card h3 {
            color: var(--secondary);
            margin-bottom: 16px;
        }

        .illness-row {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .illness-row input, .illness-row select, .illness-row textarea {
            flex: 1;
            padding: 14px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 15px;
            background: white;
            font-family: inherit;
            min-height: 50px;
        }

        .illness-row input[type="date"] {
            flex: 0 0 auto;
            width: 150px;
        }

        .illness-row input[type="number"] {
            flex: 0 0 auto;
            width: 100px;
        }

        .temp-range {
            display: flex;
            align-items: center;
            gap: 4px;
            background: var(--background);
            padding: 6px 10px;
            border-radius: 12px;
            border: 1px solid var(--border);
            min-height: 50px;
        }

        .temp-range span {
            font-size: 13px;
            color: var(--text-secondary);
            min-width: 55px;
        }

        .temp-range input {
            width: 70px;
            padding: 8px;
            border: none;
            background: transparent;
            text-align: center;
            min-height: 40px;
        }

        .temp-days {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--background);
            padding: 8px 12px;
            border-radius: 12px;
            flex: 2;
            min-height: 50px;
        }

        .temp-days label {
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .temp-days input[type="number"] {
            width: 70px;
            padding: 8px;
            min-height: 40px;
        }

        .healthy-check {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--background);
            padding: 8px 16px;
            border-radius: 12px;
            cursor: pointer;
            min-height: 50px;
        }

        /* –î–∞—Ç–∞ –≤—ã–∑–¥–æ—Ä–æ–≤–ª–µ–Ω–∏—è */
        .recovery-date {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--recovery-light);
            padding: 8px 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid var(--recovery);
        }

        .recovery-date label {
            display: flex;
            align-items: center;
            gap: 4px;
            color: var(--recovery);
            font-weight: 500;
        }

        .recovery-date input {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--recovery);
            border-radius: 10px;
            font-size: 15px;
            min-height: 44px;
        }

        .doctor-prescription {
            background: var(--background);
            padding: 16px;
            border-radius: 16px;
            margin: 12px 0;
        }

        .prescription-header {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .prescription-header textarea {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 12px;
            resize: vertical;
            min-height: 80px;
            font-size: 15px;
        }

        .prescription-photo label {
            background: var(--secondary);
            color: white;
            padding: 12px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            display: inline-block;
            min-height: 44px;
        }

        .prescription-photo input {
            display: none;
        }

        .photo-preview {
            max-width: 150px;
            max-height: 150px;
            border-radius: 12px;
            margin-top: 12px;
        }

        .medicines-list {
            background: var(--background);
            padding: 16px;
            border-radius: 16px;
            margin: 12px 0;
        }

        .medicine-item {
            display: flex;
            gap: 8px;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            align-items: center;
        }

        .medicine-item:last-child {
            border-bottom: none;
        }

        .medicine-item input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            min-height: 44px;
        }

        .antibiotic-check {
            display: flex;
            align-items: center;
            gap: 4px;
            min-width: 100px;
            font-size: 14px;
        }

        .add-medicine-btn {
            background: transparent;
            border: 1px dashed var(--secondary);
            color: var(--secondary);
            padding: 14px;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 12px;
            width: 100%;
            font-weight: 500;
            font-size: 15px;
            min-height: 50px;
        }

        .illness-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .save-illness-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 14px;
            font-weight: 600;
            cursor: pointer;
            flex: 2;
            font-size: 16px;
            min-height: 54px;
        }

        .cancel-btn {
            background: var(--background);
            color: var(--text);
            border: none;
            padding: 16px;
            border-radius: 14px;
            font-weight: 500;
            cursor: pointer;
            flex: 1;
            font-size: 16px;
            min-height: 54px;
        }

        /* –ë–ª–æ–∫ –ø—Ä–∏–≤–∏–≤–æ–∫ */
        .vaccine-section {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
        }

        .vaccine-section h3 {
            color: var(--primary);
        }

        .vaccine-form {
            background: var(--background);
            padding: 16px;
            border-radius: 16px;
            margin-bottom: 16px;
        }

        .vaccine-form input, .vaccine-form select {
            width: 100%;
            padding: 14px;
            margin: 6px 0;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 15px;
            min-height: 50px;
        }

        .vaccine-row {
            display: flex;
            gap: 8px;
        }

        .revaccination {
            background: white;
            padding: 12px;
            border-radius: 12px;
            margin-top: 8px;
        }

        .add-vaccine-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 12px;
            font-size: 16px;
            min-height: 54px;
        }

        .vaccine-history {
            max-height: 300px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .vaccine-item {
            background: var(--background);
            padding: 16px;
            border-radius: 12px;
            margin: 8px 0;
            position: relative;
            min-height: 80px;
        }

        .vaccine-item .edit-vaccine-btn {
            position: absolute;
            top: 12px;
            right: 50px;
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            cursor: pointer;
            font-size: 16px;
        }

        .vaccine-item .delete-vaccine-btn {
            position: absolute;
            top: 12px;
            right: 8px;
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: var(--danger);
            color: white;
            cursor: pointer;
            font-size: 16px;
        }

        /* –ê–ø—Ç–µ—á–∫–∞ */
        .pharmacy-section {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
        }

        .pharmacy-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .pharmacy-header h2 {
            margin: 0;
        }

        .add-medicine-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            font-size: 16px;
            min-height: 44px;
        }

        .medicine-group {
            background: var(--background);
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .medicine-group-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
        }

        .medicine-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .medicine-row:last-child {
            border-bottom: none;
        }

        .medicine-check {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .medicine-name {
            flex: 2;
            font-size: 15px;
        }

        .medicine-name.bought {
            text-decoration: line-through;
            color: var(--text-secondary);
        }

        .medicine-expiry {
            flex: 1;
            font-size: 12px;
            color: var(--danger);
        }

        .medicine-actions {
            display: flex;
            gap: 8px;
        }

        .edit-medicine-btn, .delete-medicine-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .edit-medicine-btn {
            color: var(--primary);
        }

        .delete-medicine-btn {
            color: var(--danger);
        }

        .to-buy-section {
            background: var(--danger-light);
            border-radius: 14px;
            padding: 16px;
            margin-top: 16px;
        }

        .to-buy-title {
            font-weight: 600;
            color: var(--danger);
            margin-bottom: 12px;
        }

        .to-buy-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 0;
            border-bottom: 1px dashed rgba(255, 59, 48, 0.2);
            min-height: 44px;
        }

        /* –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –±–æ–ª–µ–∑–Ω–µ–π */
        .detailed-history {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
        }

        .detailed-history h3 {
            color: var(--secondary);
            margin-bottom: 16px;
        }

        /* –ü–æ–∏—Å–∫ - —Ç–æ–ª—å–∫–æ –≤ –∏—Å—Ç–æ—Ä–∏–∏ */
        .search-section {
            background: var(--background);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 16px;
        }

        .search-input {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid var(--border);
            border-radius: 30px;
            font-size: 16px;
            background: white;
            min-height: 50px;
        }

        .history-list {
            max-height: 500px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .history-item {
            background: var(--background);
            padding: 18px;
            border-radius: 14px;
            margin: 12px 0;
            position: relative;
            border-left: 4px solid var(--secondary);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-right: 80px;
        }

        .history-name {
            font-weight: 600;
            font-size: 16px;
            color: var(--secondary);
        }

        .history-child {
            color: var(--primary);
            font-size: 14px;
            font-weight: 500;
        }

        .history-date {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .history-recovery {
            font-size: 12px;
            color: var(--recovery);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .history-temps {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 10px 0;
        }

        .history-temp-item {
            background: var(--secondary-light);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            color: var(--secondary);
        }

        .history-medicines {
            background: var(--primary-light);
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 13px;
            color: var(--primary);
            margin: 10px 0;
        }

        .history-prescription {
            background: var(--background);
            padding: 10px;
            border-radius: 10px;
            font-size: 13px;
            color: var(--text);
            font-style: italic;
            border: 1px solid var(--border);
        }

        .history-actions {
            position: absolute;
            top: 12px;
            right: 12px;
            display: flex;
            gap: 8px;
        }

        .history-edit-btn, .history-delete-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            font-size: 16px;
            transition: all 0.2s;
        }

        .history-edit-btn {
            color: var(--primary);
        }

        .history-edit-btn:hover {
            background: var(--primary);
            color: white;
        }

        .history-delete-btn {
            color: var(--danger);
        }

        .history-delete-btn:hover {
            background: var(--danger);
            color: white;
        }

        /* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-panel {
            background: white;
            border-radius: 20px;
            padding: 20px;
            border: 1px solid var(--border);
        }

        .period-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .period-input {
            flex: 1;
            padding: 14px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 14px;
            min-width: 120px;
            min-height: 50px;
        }

        .period-btn {
            padding: 14px 20px;
            border: 1px solid var(--primary);
            border-radius: 12px;
            background: white;
            color: var(--primary);
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            min-height: 50px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 16px 0;
        }

        .stat-card {
            background: var(--background);
            padding: 18px;
            border-radius: 14px;
            text-align: center;
        }

        .stat-card .value {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-card .label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 6px;
        }

        .stats-period {
            background: var(--background);
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 16px;
            text-align: center;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .diagnosis-list {
            background: var(--background);
            border-radius: 14px;
            padding: 12px;
            margin: 16px 0;
            max-height: 250px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .diagnosis-item {
            background: white;
            padding: 14px;
            border-radius: 10px;
            margin: 6px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 50px;
        }

        .diagnosis-name {
            font-weight: 500;
        }

        .diagnosis-count {
            background: var(--primary);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 24px;
            border-radius: 24px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content input, .modal-content select {
            width: 100%;
            padding: 16px;
            margin: 8px 0;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 16px;
            min-height: 54px;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-actions button {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 14px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            min-height: 54px;
        }

        .save-btn {
            background: var(--primary);
            color: white;
        }

        .cancel-btn {
            background: var(--background);
            color: var(--text);
        }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text);
            color: white;
            padding: 14px 28px;
            border-radius: 30px;
            font-size: 15px;
            animation: slideUp 0.3s;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            min-height: 50px;
        }

        @keyframes slideUp {
            from {
                transform: translate(-50%, 100px);
                opacity: 0;
            }
            to {
                transform: translate(-50%, 0);
                opacity: 1;
            }
        }

        /* –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è */
        @media (max-width: 768px) {
            body {
                padding: 0;
                overflow: hidden;
                height: 100vh;
            }
            
            .app {
                height: 100vh;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                padding: 0 0 20px 0;
                gap: 8px;
            }
            
            .glass-header {
                border-radius: 0 0 14px 14px;
                margin-top: 0;
                padding: 16px 16px 12px;
            }
            
            .stats-card, .illness-card, .vaccine-section, .pharmacy-section, .detailed-history, .stats-panel {
                border-radius: 16px;
                margin: 0 12px 8px 12px;
            }
            
            .children-selector {
                padding: 8px 12px;
                margin-bottom: 4px;
            }
        }

        /* –î–µ—Å–∫—Ç–æ–ø–Ω–∞—è –≤–µ—Ä—Å–∏—è */
        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
            
            .app {
                max-width: 1200px;
                display: grid;
                grid-template-columns: 1fr 380px;
                gap: 20px;
            }
            
            .modal-content {
                max-width: 500px;
            }
            
            .left-column {
                max-height: calc(100vh - 40px);
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                padding-right: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="left-column">
            <!-- –®–∞–ø–∫–∞ -->
            <div class="glass-header">
                <h1>üë∂ –î–µ—Ç—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ</h1>
            </div>
            
            <!-- –î–µ—Ç–∏ -->
            <div class="children-selector" id="childrenSelector"></div>
            
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–±–µ–Ω–∫–∞ -->
            <div class="stats-card" id="childStats">
                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è —Ä–µ–∂–∏–º–∞ "–í—Å–µ" –∏–ª–∏ –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º -->
                <div class="stats-row" id="statsHeader">
                    <div class="stat-item">
                        <div class="stat-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</div>
                        <div class="stat-value" id="currentTemp">36.6¬∞C</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">–°–æ—Å—Ç–æ—è–Ω–∏–µ</div>
                        <div class="stat-value" id="currentState">–ó–¥–æ—Ä–æ–≤</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">–í–µ—Å</div>
                        <div class="stat-value" id="currentWeight">--</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">–ë–æ–ª–µ–µ—Ç</div>
                        <div class="stat-value" id="illnessDays">0</div>
                    </div>
                </div>
                
                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å—Ç—Ä–æ–∫ –¥–µ—Ç–µ–π –≤ —Ä–µ–∂–∏–º–µ "–í—Å–µ" -->
                <div id="allChildrenStats" style="display: none;"></div>
                
                <!-- –ü–ª–∞–Ω–æ–≤—ã–µ –ø—Ä–∏–≤–∏–≤–∫–∏ -->
                <div class="planned-vaccines" id="plannedVaccines">
                    <div style="font-size:13px; margin-bottom:8px; opacity:0.9;">üìÖ –ü–ª–∞–Ω–æ–≤—ã–µ –ø—Ä–∏–≤–∏–≤–∫–∏:</div>
                </div>
            </div>
            
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –±–æ–ª–µ–∑–Ω–∏ -->
            <div class="illness-card">
                <h3>üè• –ë–æ–ª–µ–∑–Ω—å / –û—Å–º–æ—Ç—Ä</h3>
                
                <input type="hidden" id="editingEntryId" value="">
                
                <select id="illnessChild">
                    <option value="">üë∂ –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–±–µ–Ω–∫–∞</option>
                </select>
                
                <!-- –í–µ—Å –∏ –¥–∞—Ç–∞ -->
                <div class="illness-row">
                    <input type="number" id="illnessWeight" placeholder="–í–µ—Å (–∫–≥)" step="0.1">
                    <label class="healthy-check">
                        <input type="checkbox" id="illnessHealthy"> ‚úÖ –ó–¥–æ—Ä–æ–≤
                    </label>
                    <input type="date" id="illnessDate" value="">
                </div>
                
                <!-- –î–∞—Ç–∞ –≤—ã–∑–¥–æ—Ä–æ–≤–ª–µ–Ω–∏—è -->
                <div class="recovery-date">
                    <label>‚ú® –í—ã–∑–¥–æ—Ä–æ–≤–ª–µ–Ω–∏–µ</label>
                    <input type="date" id="recoveryDate">
                </div>
                
                <!-- 1-–π –¥–µ–Ω—å -->
                <div class="illness-row">
                    <div class="temp-range">
                        <span>1-–π –¥–µ–Ω—å</span>
                        <input type="number" id="temp1From" placeholder="–æ—Ç" value="36.6" step="0.1">
                        <span>-</span>
                        <input type="number" id="temp1To" placeholder="–¥–æ" value="36.6" step="0.1">
                    </div>
                </div>
                
                <!-- 2-–π –¥–µ–Ω—å -->
                <div class="illness-row">
                    <div class="temp-range">
                        <span>2-–π –¥–µ–Ω—å</span>
                        <input type="number" id="temp2From" placeholder="–æ—Ç" value="36.6" step="0.1">
                        <span>-</span>
                        <input type="number" id="temp2To" placeholder="–¥–æ" value="36.6" step="0.1">
                    </div>
                </div>
                
                <!-- 3-–π –¥–µ–Ω—å -->
                <div class="illness-row">
                    <div class="temp-range">
                        <span>3-–π –¥–µ–Ω—å</span>
                        <input type="number" id="temp3From" placeholder="–æ—Ç" value="36.6" step="0.1">
                        <span>-</span>
                        <input type="number" id="temp3To" placeholder="–¥–æ" value="36.6" step="0.1">
                    </div>
                </div>
                
                <!-- –ë–æ–ª–µ–µ 3 –¥–Ω–µ–π –∏ –¥–∏–∞–≥–Ω–æ–∑ -->
                <div class="illness-row">
                    <div class="temp-days">
                        <label>
                            <input type="checkbox" id="tempMoreThan3"> üî• >3 –¥–Ω–µ–π
                        </label>
                        <input type="number" id="tempDaysCount" placeholder="–¥–Ω–µ–π" min="1" value="4">
                    </div>
                    <input type="text" id="illnessTitle" placeholder="–î–∏–∞–≥–Ω–æ–∑" style="flex:2;">
                </div>
                
                <!-- –ù–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤—Ä–∞—á–∞ -->
                <div class="doctor-prescription">
                    <div class="prescription-header">
                        <textarea id="prescriptionText" placeholder="–ù–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤—Ä–∞—á–∞..." rows="2"></textarea>
                        <div class="prescription-photo">
                            <label for="prescriptionPhoto">üì∏ –§–æ—Ç–æ</label>
                            <input type="file" id="prescriptionPhoto" accept="image/*" onchange="previewPrescriptionPhoto(event)">
                        </div>
                    </div>
                    <div id="prescriptionPhotoPreview"></div>
                </div>
                
                <!-- –õ–µ–∫–∞—Ä—Å—Ç–≤–∞ -->
                <div class="medicines-list" id="medicinesContainer">
                    <!-- –®–∞–±–ª–æ–Ω –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
                <button class="add-medicine-btn" onclick="addMedicineRow()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–æ</button>
                
                <!-- –ö–Ω–æ–ø–∫–∏ -->
                <div class="illness-actions">
                    <button class="save-illness-btn" onclick="saveIllness()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button class="cancel-btn" onclick="clearIllnessForm()">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
            </div>
            
            <!-- –ë–ª–æ–∫ –ø—Ä–∏–≤–∏–≤–æ–∫ -->
            <div class="vaccine-section">
                <h3>üíâ –í–∞–∫—Ü–∏–Ω–∞—Ü–∏—è</h3>
                
                <div class="vaccine-form">
                    <input type="hidden" id="editingVaccineId" value="">
                    
                    <select id="vaccineChild">
                        <option value="">üë∂ –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–±–µ–Ω–∫–∞</option>
                    </select>
                    
                    <input type="text" id="vaccineName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤–∏–≤–∫–∏">
                    
                    <div class="vaccine-row">
                        <input type="date" id="vaccineDate" value="">
                        <select id="vaccineStatus">
                            <option value="done">‚úÖ –°–¥–µ–ª–∞–Ω–æ</option>
                            <option value="planned">üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ</option>
                        </select>
                    </div>
                    
                    <div class="revaccination">
                        <div class="vaccine-row">
                            <input type="date" id="revaccinationDate" placeholder="–†–µ–≤–∞–∫—Ü–∏–Ω–∞—Ü–∏—è">
                            <input type="number" id="vaccineTemp" placeholder="–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞" value="36.6" step="0.1">
                        </div>
                    </div>
                    
                    <button class="add-vaccine-btn" onclick="saveVaccine()">‚ûï –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–∏–≤–∏–≤–∫—É</button>
                </div>
                
                <h3>–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–∏–≤–∏–≤–æ–∫</h3>
                <div class="vaccine-history" id="vaccineHistory"></div>
            </div>
            
            <!-- –ê–ø—Ç–µ—á–∫–∞ -->
            <div class="pharmacy-section">
                <div class="pharmacy-header">
                    <h2>üíä –ê–ø—Ç–µ—á–∫–∞</h2>
                    <button class="add-medicine-btn" onclick="showMedicineModal()">‚ûï</button>
                </div>
                <div id="pharmacyList"></div>
                
                <div class="to-buy-section">
                    <div class="to-buy-title">üõí –ù—É–∂–Ω–æ –∫—É–ø–∏—Ç—å</div>
                    <div id="shoppingList"></div>
                </div>
            </div>
            
            <!-- –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —Å –ø–æ–∏—Å–∫–æ–º -->
            <div class="detailed-history">
                <h3>üìã –ò—Å—Ç–æ—Ä–∏—è –±–æ–ª–µ–∑–Ω–µ–π</h3>
                
                <!-- –ü–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –∑–¥–µ—Å—å -->
                <div class="search-section">
                    <input type="text" class="search-input" id="searchInput" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∑–∞–ø–∏—Å—è–º" onkeyup="updateIllnessHistory()">
                </div>
                
                <div class="history-list" id="illnessHistory"></div>
            </div>
        </div>
        
        <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-panel">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            
            <!-- –í—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ -->
            <div class="period-selector">
                <input type="date" id="periodStart" class="period-input" onchange="updateStats()">
                <input type="date" id="periodEnd" class="period-input" onchange="updateStats()">
                <button class="period-btn" onclick="setLastMonth()">–ú–µ—Å—è—Ü</button>
            </div>
            
            <div class="stats-period" id="statsPeriod"></div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="value" id="totalIllnesses">0</div>
                    <div class="label">–ë–æ–ª–µ–∑–Ω–∏</div>
                </div>
                <div class="stat-card">
                    <div class="value" id="totalAntibiotics">0</div>
                    <div class="label">–ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏</div>
                </div>
            </div>
            
            <h3>üî¨ –î–∏–∞–≥–Ω–æ–∑—ã</h3>
            <div class="diagnosis-list" id="diagnosisList"></div>
            
            <h3>üíä –ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏</h3>
            <div class="diagnosis-list" id="antibioticsList"></div>
            
            <!-- –≠–∫—Å–ø–æ—Ä—Ç -->
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="exportCSV()" style="flex:1; background:var(--primary); color:white; padding:16px; border:none; border-radius:14px; cursor:pointer; font-weight:600; font-size:16px; min-height:54px;">üì• CSV</button>
                <button onclick="exportJSON()" style="flex:1; background:var(--secondary); color:white; padding:16px; border:none; border-radius:14px; cursor:pointer; font-weight:600; font-size:16px; min-height:54px;">üíæ –ë—ç–∫–∞–ø</button>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª–∫–∏ -->
    <div id="childModal" class="modal" style="display:none;" onclick="if(event.target===this) closeChildModal()">
        <div class="modal-content">
            <h2 id="childModalTitle">üë∂ –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–±–µ–Ω–∫–∞</h2>
            <input type="hidden" id="editingChildId" value="">
            <input type="text" id="childName" placeholder="–ò–º—è">
            <input type="date" id="childBirthDate" placeholder="–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è">
            <input type="number" id="childWeight" placeholder="–í–µ—Å (–∫–≥)" step="0.1">
            <div class="modal-actions">
                <button class="save-btn" onclick="saveChild()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="cancel-btn" onclick="closeChildModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>
    
    <div id="medicineModal" class="modal" style="display:none;" onclick="if(event.target===this) closeMedicineModal()">
        <div class="modal-content">
            <h2>üíä –î–æ–±–∞–≤–∏—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–æ</h2>
            <select id="medChild"></select>
            <input type="text" id="medName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
            <input type="date" id="medExpiry" placeholder="–°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏">
            <div class="modal-actions">
                <button class="save-btn" onclick="saveMedicine()">–î–æ–±–∞–≤–∏—Ç—å</button>
                <button class="cancel-btn" onclick="closeMedicineModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>
    
    <div id="editMedicineModal" class="modal" style="display:none;" onclick="if(event.target===this) closeEditMedicineModal()">
        <div class="modal-content">
            <h2>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–æ</h2>
            <input type="hidden" id="editMedId">
            <select id="editMedChild"></select>
            <input type="text" id="editMedName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
            <input type="date" id="editMedExpiry" placeholder="–°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏">
            <div class="modal-actions">
                <button class="save-btn" onclick="updateMedicine()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="cancel-btn" onclick="closeEditMedicineModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ
        let children = JSON.parse(localStorage.getItem('children')) || [];
        let entries = JSON.parse(localStorage.getItem('entries')) || [];
        let pharmacy = JSON.parse(localStorage.getItem('pharmacy')) || [];
        let vaccines = JSON.parse(localStorage.getItem('vaccines')) || [];
        let selectedChild = 'all';
        let prescriptionPhoto = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            loadChildren();
            setTodayDate();
            setDefaultPeriod();
            updateAll();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            if (document.getElementById('medicinesContainer').children.length === 0) {
                addMedicineRow();
            }
            
            // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º Service Worker –¥–ª—è PWA
            registerServiceWorker();
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker –¥–ª—è –æ—Ñ–ª–∞–π–Ω-—Ä–∞–±–æ—Ç—ã
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('service-worker.js').catch(err => {
                    console.log('Service Worker registration failed, but PWA will still work');
                });
            }
        }

        function setTodayDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('illnessDate').value = today;
            document.getElementById('vaccineDate').value = today;
            
            // –î–∞—Ç–∞ –≤—ã–∑–¥–æ—Ä–æ–≤–ª–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é +7 –¥–Ω–µ–π
            const recoveryDate = new Date();
            recoveryDate.setDate(recoveryDate.getDate() + 7);
            document.getElementById('recoveryDate').value = recoveryDate.toISOString().split('T')[0];
        }

        function setDefaultPeriod() {
            const today = new Date();
            const sixMonthsAgo = new Date();
            sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);
            
            document.getElementById('periodEnd').value = today.toISOString().split('T')[0];
            document.getElementById('periodStart').value = sixMonthsAgo.toISOString().split('T')[0];
        }

        function setLastMonth() {
            const today = new Date();
            const monthAgo = new Date();
            monthAgo.setMonth(monthAgo.getMonth() - 1);
            
            document.getElementById('periodEnd').value = today.toISOString().split('T')[0];
            document.getElementById('periodStart').value = monthAgo.toISOString().split('T')[0];
            updateStats();
        }

        // –î–µ—Ç–∏
        function loadChildren() {
            const container = document.getElementById('childrenSelector');
            let html = '';
            
            // –ö–Ω–æ–ø–∫–∞ "–í—Å–µ"
            html += `
                <div class="child-item">
                    <button class="child-btn all-btn ${selectedChild === 'all' ? 'active' : ''}" onclick="selectChild('all')">üë• –í—Å–µ</button>
                </div>
            `;
            
            children.forEach((child, i) => {
                const age = child.birthDate ? calculateAge(child.birthDate) : '?';
                
                html += `
                    <div class="child-item">
                        <button class="child-btn ${selectedChild === i ? 'active' : ''}" onclick="selectChild(${i})">${child.name} (${age} –ª–µ—Ç, ${child.weight || '?'} –∫–≥)</button>
                        <button class="edit-child-btn" onclick="editChild(${i})">‚úèÔ∏è</button>
                        <button class="delete-child-btn" onclick="deleteChild(${i})">üóëÔ∏è</button>
                    </div>
                `;
            });
            
            html += `<button class="add-child-btn" onclick="showChildModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>`;
            container.innerHTML = html;
            
            const selects = ['illnessChild', 'vaccineChild', 'medChild', 'editMedChild'];
            selects.forEach(id => {
                const select = document.getElementById(id);
                if (select) {
                    select.innerHTML = '<option value="">üë∂ –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–±–µ–Ω–∫–∞</option>' + 
                        children.map((c, i) => `<option value="${i}">${c.name}</option>`).join('');
                }
            });
        }

        function calculateAge(birthDate) {
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const m = today.getMonth() - birth.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            return age;
        }

        function selectChild(index) {
            selectedChild = index;
            loadChildren();
            updateAll();
        }

        function showChildModal() {
            document.getElementById('childModalTitle').innerHTML = 'üë∂ –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–±–µ–Ω–∫–∞';
            document.getElementById('editingChildId').value = '';
            document.getElementById('childName').value = '';
            document.getElementById('childBirthDate').value = '';
            document.getElementById('childWeight').value = '';
            document.getElementById('childModal').style.display = 'flex';
        }

        function editChild(index) {
            const child = children[index];
            document.getElementById('childModalTitle').innerHTML = '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–±–µ–Ω–∫–∞';
            document.getElementById('editingChildId').value = index;
            document.getElementById('childName').value = child.name;
            document.getElementById('childBirthDate').value = child.birthDate || '';
            document.getElementById('childWeight').value = child.weight || '';
            document.getElementById('childModal').style.display = 'flex';
        }

        function deleteChild(index) {
            if (confirm(`–£–¥–∞–ª–∏—Ç—å —Ä–µ–±–µ–Ω–∫–∞ ${children[index].name}?`)) {
                children.splice(index, 1);
                entries = entries.filter(e => e.childIndex !== index);
                pharmacy = pharmacy.filter(p => p.childIndex !== index);
                vaccines = vaccines.filter(v => v.childIndex !== index);
                
                entries = entries.map(e => {
                    if (e.childIndex > index) e.childIndex--;
                    return e;
                });
                
                pharmacy = pharmacy.map(p => {
                    if (p.childIndex > index) p.childIndex--;
                    return p;
                });
                
                vaccines = vaccines.map(v => {
                    if (v.childIndex > index) v.childIndex--;
                    return v;
                });
                
                if (selectedChild === index) {
                    selectedChild = children.length > 0 ? 0 : 'all';
                } else if (typeof selectedChild === 'number' && selectedChild > index) {
                    selectedChild--;
                }
                
                saveData();
                localStorage.setItem('vaccines', JSON.stringify(vaccines));
                loadChildren();
                updateAll();
                showMessage('üóëÔ∏è –†–µ–±–µ–Ω–æ–∫ —É–¥–∞–ª–µ–Ω');
            }
        }

        function closeChildModal() {
            document.getElementById('childModal').style.display = 'none';
        }

        function saveChild() {
            const name = document.getElementById('childName').value.trim();
            const birthDate = document.getElementById('childBirthDate').value;
            const weight = document.getElementById('childWeight').value;
            const editId = document.getElementById('editingChildId').value;
            
            if (!name || !birthDate) { alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è!'); return; }
            
            const childData = {
                name: name,
                birthDate: birthDate,
                weight: weight || null
            };
            
            if (editId) {
                children[editId] = childData;
                showMessage('‚úèÔ∏è –†–µ–±–µ–Ω–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω');
            } else {
                children.push(childData);
                if (selectedChild === 'all') selectedChild = children.length - 1;
                showMessage('üë∂ –†–µ–±–µ–Ω–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω');
            }
            
            saveData();
            closeChildModal();
            loadChildren();
            updateAll();
        }

        // –õ–µ–∫–∞—Ä—Å—Ç–≤–∞
        function addMedicineRow(name = '', isAntibiotic = false) {
            const container = document.getElementById('medicinesContainer');
            const rowId = 'medicine_' + Date.now() + Math.random();
            
            const row = document.createElement('div');
            row.className = 'medicine-item';
            row.id = rowId;
            row.innerHTML = `
                <input type="text" class="medicine-name-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞" value="${name.replace(/"/g, '&quot;')}">
                <label class="antibiotic-check">
                    <input type="checkbox" class="antibiotic-checkbox" ${isAntibiotic ? 'checked' : ''}> –ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫
                </label>
            `;
            
            container.appendChild(row);
        }

        function clearMedicinesList() {
            const container = document.getElementById('medicinesContainer');
            container.innerHTML = '';
        }

        function previewPrescriptionPhoto(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    prescriptionPhoto = e.target.result;
                    document.getElementById('prescriptionPhotoPreview').innerHTML = 
                        `<img src="${e.target.result}" class="photo-preview">`;
                };
                reader.readAsDataURL(file);
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
        function saveIllness() {
            const childIndex = document.getElementById('illnessChild').value;
            const title = document.getElementById('illnessTitle').value.trim();
            const weight = document.getElementById('illnessWeight').value;
            const isHealthy = document.getElementById('illnessHealthy').checked;
            const recoveryDate = document.getElementById('recoveryDate').value;
            const editId = document.getElementById('editingEntryId').value;
            
            if (!childIndex) { alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–±–µ–Ω–∫–∞!'); return; }
            
            const temps = {
                day1: { from: document.getElementById('temp1From').value, to: document.getElementById('temp1To').value },
                day2: { from: document.getElementById('temp2From').value, to: document.getElementById('temp2To').value },
                day3: { from: document.getElementById('temp3From').value, to: document.getElementById('temp3To').value }
            };
            
            const tempMoreThan3 = document.getElementById('tempMoreThan3').checked;
            const tempDaysCount = document.getElementById('tempDaysCount').value;
            const prescription = document.getElementById('prescriptionText').value.trim();
            
            // –°–æ–±–∏—Ä–∞–µ–º –ª–µ–∫–∞—Ä—Å—Ç–≤–∞
            const medicines = [];
            document.querySelectorAll('.medicine-item').forEach(item => {
                const input = item.querySelector('.medicine-name-input');
                if (input) {
                    const name = input.value.trim();
                    const checkbox = item.querySelector('.antibiotic-checkbox');
                    const isAntibiotic = checkbox ? checkbox.checked : false;
                    
                    if (name) {
                        medicines.push({ name, isAntibiotic });
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–ø—Ç–µ—á–∫—É, –µ—Å–ª–∏ —Ç–∞–∫–æ–≥–æ –µ—â–µ –Ω–µ—Ç
                        const exists = pharmacy.some(p => 
                            p.name.toLowerCase() === name.toLowerCase() && 
                            p.childIndex === parseInt(childIndex)
                        );
                        
                        if (!exists) {
                            pharmacy.push({
                                id: Date.now() + Math.random(),
                                name: name,
                                childIndex: parseInt(childIndex),
                                childName: children[parseInt(childIndex)].name,
                                isAntibiotic: isAntibiotic,
                                bought: false
                            });
                        }
                    }
                }
            });
            
            const entry = {
                id: editId ? parseInt(editId) : Date.now(),
                childIndex: parseInt(childIndex),
                title: title || '–û—Å–º–æ—Ç—Ä',
                weight: weight,
                isHealthy: isHealthy,
                recoveryDate: recoveryDate,
                temps: temps,
                tempMoreThan3: tempMoreThan3,
                tempDaysCount: tempDaysCount,
                prescription: prescription,
                prescriptionPhoto: prescriptionPhoto,
                medicines: medicines,
                date: document.getElementById('illnessDate').value + 'T12:00:00'
            };
            
            if (editId) {
                const index = entries.findIndex(e => e.id === parseInt(editId));
                if (index !== -1) entries[index] = entry;
                showMessage('‚úèÔ∏è –ó–∞–ø–∏—Å—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
            } else {
                entries.push(entry);
                showMessage('‚úÖ –ó–∞–ø–∏—Å—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞');
            }
            
            localStorage.setItem('pharmacy', JSON.stringify(pharmacy));
            saveData();
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–¥–ª—è –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏)
            if (!editId) {
                clearIllnessForm();
            } else {
                // –ü–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–∂–µ –æ—á–∏—â–∞–µ–º –∏ –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                clearIllnessForm();
            }
            
            updateAll();
        }

        function clearIllnessForm() {
            document.getElementById('editingEntryId').value = '';
            document.getElementById('illnessChild').value = '';
            document.getElementById('illnessWeight').value = '';
            document.getElementById('illnessHealthy').checked = false;
            document.getElementById('temp1From').value = '36.6';
            document.getElementById('temp1To').value = '36.6';
            document.getElementById('temp2From').value = '36.6';
            document.getElementById('temp2To').value = '36.6';
            document.getElementById('temp3From').value = '36.6';
            document.getElementById('temp3To').value = '36.6';
            document.getElementById('tempMoreThan3').checked = false;
            document.getElementById('tempDaysCount').value = '4';
            document.getElementById('illnessTitle').value = '';
            document.getElementById('prescriptionText').value = '';
            document.getElementById('prescriptionPhotoPreview').innerHTML = '';
            
            // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –ª–µ–∫–∞—Ä—Å—Ç–≤ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ–¥–Ω—É –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
            clearMedicinesList();
            addMedicineRow();
            
            prescriptionPhoto = null;
            setTodayDate();
        }

        function editEntry(id) {
            const entry = entries.find(e => e.id === id);
            if (!entry) return;
            
            document.getElementById('editingEntryId').value = entry.id;
            document.getElementById('illnessChild').value = entry.childIndex;
            document.getElementById('illnessWeight').value = entry.weight || '';
            document.getElementById('illnessHealthy').checked = entry.isHealthy || false;
            document.getElementById('recoveryDate').value = entry.recoveryDate || '';
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É
            if (entry.temps) {
                document.getElementById('temp1From').value = entry.temps.day1?.from || '36.6';
                document.getElementById('temp1To').value = entry.temps.day1?.to || '36.6';
                document.getElementById('temp2From').value = entry.temps.day2?.from || '36.6';
                document.getElementById('temp2To').value = entry.temps.day2?.to || '36.6';
                document.getElementById('temp3From').value = entry.temps.day3?.from || '36.6';
                document.getElementById('temp3To').value = entry.temps.day3?.to || '36.6';
            }
            
            document.getElementById('tempMoreThan3').checked = entry.tempMoreThan3 || false;
            document.getElementById('tempDaysCount').value = entry.tempDaysCount || '4';
            document.getElementById('illnessTitle').value = entry.title || '';
            document.getElementById('prescriptionText').value = entry.prescription || '';
            
            const date = new Date(entry.date);
            document.getElementById('illnessDate').value = date.toISOString().split('T')[0];
            
            if (entry.prescriptionPhoto) {
                prescriptionPhoto = entry.prescriptionPhoto;
                document.getElementById('prescriptionPhotoPreview').innerHTML = 
                    `<img src="${entry.prescriptionPhoto}" class="photo-preview">`;
            }
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ª–µ–∫–∞—Ä—Å—Ç–≤–∞
            clearMedicinesList();
            if (entry.medicines && entry.medicines.length > 0) {
                entry.medicines.forEach(med => {
                    addMedicineRow(med.name, med.isAntibiotic);
                });
            } else {
                addMedicineRow();
            }
        }

        // –ü—Ä–∏–≤–∏–≤–∫–∏
        function saveVaccine() {
            const childIndex = document.getElementById('vaccineChild').value;
            const name = document.getElementById('vaccineName').value.trim();
            const date = document.getElementById('vaccineDate').value;
            const status = document.getElementById('vaccineStatus').value;
            const revaccination = document.getElementById('revaccinationDate').value;
            const temp = document.getElementById('vaccineTemp').value;
            const editId = document.getElementById('editingVaccineId').value;
            
            if (!childIndex) { alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–±–µ–Ω–∫–∞!'); return; }
            if (!name) { alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤–∏–≤–∫–∏!'); return; }
            if (!date) { alert('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É!'); return; }
            
            const vaccine = {
                id: editId ? parseInt(editId) : Date.now(),
                childIndex: parseInt(childIndex),
                name: name,
                date: date,
                status: status,
                revaccination: revaccination,
                temperature: temp
            };
            
            if (editId) {
                const index = vaccines.findIndex(v => v.id === parseInt(editId));
                if (index !== -1) vaccines[index] = vaccine;
                showMessage('‚úèÔ∏è –ü—Ä–∏–≤–∏–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
            } else {
                vaccines.push(vaccine);
                showMessage('üíâ –ü—Ä–∏–≤–∏–≤–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞');
            }
            
            localStorage.setItem('vaccines', JSON.stringify(vaccines));
            
            document.getElementById('editingVaccineId').value = '';
            document.getElementById('vaccineName').value = '';
            document.getElementById('revaccinationDate').value = '';
            updateVaccineHistory();
            updateCurrentStats();
            updateStats();
        }

        function editVaccine(id) {
            const vaccine = vaccines.find(v => v.id === id);
            if (!vaccine) return;
            
            document.getElementById('editingVaccineId').value = vaccine.id;
            document.getElementById('vaccineChild').value = vaccine.childIndex;
            document.getElementById('vaccineName').value = vaccine.name;
            document.getElementById('vaccineDate').value = vaccine.date;
            document.getElementById('vaccineStatus').value = vaccine.status;
            document.getElementById('revaccinationDate').value = vaccine.revaccination || '';
            document.getElementById('vaccineTemp').value = vaccine.temperature || '36.6';
        }

        function deleteVaccine(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–∏–≤–∏–≤–∫—É?')) {
                vaccines = vaccines.filter(v => v.id !== id);
                localStorage.setItem('vaccines', JSON.stringify(vaccines));
                updateVaccineHistory();
                updateCurrentStats();
                updateStats();
                showMessage('üóëÔ∏è –ü—Ä–∏–≤–∏–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∞');
            }
        }

        function updateVaccineHistory() {
            const container = document.getElementById('vaccineHistory');
            
            let filteredVaccines = vaccines;
            if (selectedChild !== 'all') {
                filteredVaccines = vaccines.filter(v => v.childIndex === selectedChild);
            }
            
            const doneVaccines = filteredVaccines.filter(v => v.status === 'done')
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (doneVaccines.length === 0) {
                container.innerHTML = '<div style="color:#8E8E93; text-align:center; padding:20px;">–ù–µ—Ç —Å–¥–µ–ª–∞–Ω–Ω—ã—Ö –ø—Ä–∏–≤–∏–≤–æ–∫</div>';
                return;
            }
            
            container.innerHTML = doneVaccines.map(v => {
                const child = children[v.childIndex]?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                const date = new Date(v.date).toLocaleDateString();
                
                return `
                    <div class="vaccine-item">
                        <button class="edit-vaccine-btn" onclick="editVaccine(${v.id})">‚úèÔ∏è</button>
                        <button class="delete-vaccine-btn" onclick="deleteVaccine(${v.id})">üóëÔ∏è</button>
                        <div style="font-weight:600;">${child} - ${v.name}</div>
                        <div style="font-size:13px; color:#8E8E93;">${date}</div>
                        ${v.revaccination ? `<div style="font-size:12px; margin-top:4px;">üìÖ –†–µ–≤–∞–∫—Ü–∏–Ω–∞—Ü–∏—è: ${new Date(v.revaccination).toLocaleDateString()}</div>` : ''}
                        ${v.temperature && v.temperature != 36.6 ? `<div style="font-size:12px; color:#FF3B30;">üå°Ô∏è –†–µ–∞–∫—Ü–∏—è: ${v.temperature}¬∞C</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        // –ê–ø—Ç–µ—á–∫–∞
        function showMedicineModal() {
            document.getElementById('medicineModal').style.display = 'flex';
        }

        function closeMedicineModal() {
            document.getElementById('medicineModal').style.display = 'none';
            document.getElementById('medName').value = '';
            document.getElementById('medExpiry').value = '';
        }

        function saveMedicine() {
            const child = document.getElementById('medChild').value;
            const name = document.getElementById('medName').value.trim();
            
            if (!child) { alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–±–µ–Ω–∫–∞!'); return; }
            if (!name) { alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ!'); return; }
            
            pharmacy.push({
                id: Date.now(),
                name: name,
                childIndex: parseInt(child),
                childName: children[parseInt(child)].name,
                expiry: document.getElementById('medExpiry').value,
                bought: false
            });
            
            localStorage.setItem('pharmacy', JSON.stringify(pharmacy));
            closeMedicineModal();
            updatePharmacy();
            showMessage('üíä –õ–µ–∫–∞—Ä—Å—Ç–≤–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ');
        }

        function editMedicine(id) {
            const medicine = pharmacy.find(m => m.id === id);
            if (!medicine) return;
            
            document.getElementById('editMedId').value = medicine.id;
            document.getElementById('editMedChild').value = medicine.childIndex;
            document.getElementById('editMedName').value = medicine.name;
            document.getElementById('editMedExpiry').value = medicine.expiry || '';
            
            document.getElementById('editMedicineModal').style.display = 'flex';
        }

        function closeEditMedicineModal() {
            document.getElementById('editMedicineModal').style.display = 'none';
        }

        function updateMedicine() {
            const id = parseFloat(document.getElementById('editMedId').value);
            const medicine = pharmacy.find(m => m.id === id);
            
            if (medicine) {
                medicine.childIndex = parseInt(document.getElementById('editMedChild').value);
                medicine.childName = children[medicine.childIndex].name;
                medicine.name = document.getElementById('editMedName').value.trim();
                medicine.expiry = document.getElementById('editMedExpiry').value;
                
                localStorage.setItem('pharmacy', JSON.stringify(pharmacy));
                closeEditMedicineModal();
                updatePharmacy();
                showMessage('‚úèÔ∏è –õ–µ–∫–∞—Ä—Å—Ç–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ');
            }
        }

        function deleteMedicine(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–æ –∏–∑ –∞–ø—Ç–µ—á–∫–∏?')) {
                pharmacy = pharmacy.filter(m => m.id !== id);
                localStorage.setItem('pharmacy', JSON.stringify(pharmacy));
                updatePharmacy();
                showMessage('üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ');
            }
        }

        function toggleBought(id) {
            const item = pharmacy.find(p => p.id === id);
            if (item) {
                item.bought = !item.bought;
                localStorage.setItem('pharmacy', JSON.stringify(pharmacy));
                updatePharmacy();
            }
        }

        function updatePharmacy() {
            const container = document.getElementById('pharmacyList');
            const shoppingContainer = document.getElementById('shoppingList');
            
            let filteredPharmacy = pharmacy;
            if (selectedChild !== 'all') {
                filteredPharmacy = pharmacy.filter(p => p.childIndex === selectedChild);
            }
            
            if (filteredPharmacy.length === 0) {
                container.innerHTML = '<div style="color:#8E8E93; text-align:center; padding:20px;">–ê–ø—Ç–µ—á–∫–∞ –ø—É—Å—Ç–∞</div>';
                shoppingContainer.innerHTML = '<div style="color:#8E8E93;">–ù–µ—Ç –ª–µ–∫–∞—Ä—Å—Ç–≤</div>';
                return;
            }
            
            const byChild = {};
            filteredPharmacy.forEach(p => {
                if (!byChild[p.childIndex]) byChild[p.childIndex] = [];
                byChild[p.childIndex].push(p);
            });
            
            let html = '';
            Object.keys(byChild).forEach(childIndex => {
                const child = children[childIndex];
                if (!child) return;
                
                html += `<div class="medicine-group">`;
                html += `<div class="medicine-group-title">
                    üë∂ ${child.name}
                    <span>${byChild[childIndex].filter(m => !m.bought).length} –Ω—É–∂–Ω–æ</span>
                </div>`;
                
                byChild[childIndex].forEach(m => {
                    const isExpired = m.expiry && new Date(m.expiry) < new Date();
                    html += `
                        <div class="medicine-row">
                            <input type="checkbox" class="medicine-check" ${m.bought ? 'checked' : ''} onchange="toggleBought(${m.id})">
                            <span class="medicine-name ${m.bought ? 'bought' : ''}">${m.name} ${m.isAntibiotic ? 'üíä' : ''}</span>
                            ${m.expiry ? `<span class="medicine-expiry">${isExpired ? '‚ùó' : ''} ${new Date(m.expiry).toLocaleDateString()}</span>` : ''}
                            <div class="medicine-actions">
                                <button class="edit-medicine-btn" onclick="editMedicine(${m.id})">‚úèÔ∏è</button>
                                <button class="delete-medicine-btn" onclick="deleteMedicine(${m.id})">üóëÔ∏è</button>
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
            });
            container.innerHTML = html;
            
            const toBuy = filteredPharmacy.filter(p => !p.bought);
            if (toBuy.length === 0) {
                shoppingContainer.innerHTML = '<div style="color:#8E8E93;">‚úÖ –í—Å—ë –∫—É–ø–ª–µ–Ω–æ</div>';
            } else {
                const toBuyByChild = {};
                toBuy.forEach(p => {
                    if (!toBuyByChild[p.childIndex]) toBuyByChild[p.childIndex] = [];
                    toBuyByChild[p.childIndex].push(p);
                });
                
                let shoppingHtml = '';
                Object.keys(toBuyByChild).forEach(childIndex => {
                    const child = children[childIndex];
                    toBuyByChild[childIndex].forEach(p => {
                        shoppingHtml += `
                            <div class="to-buy-item">
                                <input type="checkbox" onchange="toggleBought(${p.id})">
                                <span>${child.name}: ${p.name} ${p.isAntibiotic ? 'üíä' : ''}</span>
                            </div>
                        `;
                    });
                });
                shoppingContainer.innerHTML = shoppingHtml;
            }
        }

        // –¢–µ–∫—É—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        function updateCurrentStats() {
            const statsHeader = document.getElementById('statsHeader');
            const allChildrenContainer = document.getElementById('allChildrenStats');
            
            if (selectedChild !== 'all' && children[selectedChild]) {
                // –†–µ–∂–∏–º –æ–¥–Ω–æ–≥–æ —Ä–µ–±–µ–Ω–∫–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
                statsHeader.style.display = 'grid';
                allChildrenContainer.style.display = 'none';
                
                const childEntries = entries.filter(e => e.childIndex === selectedChild);
                const lastEntry = childEntries.sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                
                if (lastEntry) {
                    const lastTemp = lastEntry.temps?.day3?.to || lastEntry.temps?.day2?.to || lastEntry.temps?.day1?.to || '36.6';
                    document.getElementById('currentTemp').innerHTML = lastTemp + '¬∞C';
                    document.getElementById('currentWeight').innerHTML = lastEntry.weight ? lastEntry.weight + ' –∫–≥' : (children[selectedChild].weight || '--') + ' –∫–≥';
                    document.getElementById('currentState').innerHTML = lastEntry.isHealthy ? '‚úÖ –ó–¥–æ—Ä–æ–≤' : (lastEntry.title || '–ë–æ–ª–µ–µ—Ç');
                } else {
                    document.getElementById('currentTemp').innerHTML = '36.6¬∞C';
                    document.getElementById('currentWeight').innerHTML = (children[selectedChild].weight || '--') + ' –∫–≥';
                    document.getElementById('currentState').innerHTML = '–ó–¥–æ—Ä–æ–≤';
                }
                
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                
                const recentEntries = childEntries.filter(e => new Date(e.date) > thirtyDaysAgo);
                const symptomDays = new Set();
                recentEntries.forEach(e => {
                    if (e.temps) {
                        const hasFever = 
                            (e.temps.day1?.to && parseFloat(e.temps.day1.to) > 37) ||
                            (e.temps.day2?.to && parseFloat(e.temps.day2.to) > 37) ||
                            (e.temps.day3?.to && parseFloat(e.temps.day3.to) > 37) ||
                            e.tempMoreThan3;
                        
                        if (hasFever) {
                            symptomDays.add(new Date(e.date).toDateString());
                        }
                    }
                });
                document.getElementById('illnessDays').innerHTML = symptomDays.size + ' –¥–Ω.';
                
                // –ü–ª–∞–Ω–æ–≤—ã–µ –ø—Ä–∏–≤–∏–≤–∫–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ä–µ–±–µ–Ω–∫–∞
                const plannedVaccines = vaccines.filter(v => v.childIndex === selectedChild && v.status === 'planned')
                    .sort((a, b) => new Date(a.date) - new Date(b.date));
                
                const plannedContainer = document.getElementById('plannedVaccines');
                if (plannedVaccines.length > 0) {
                    let plannedHtml = '<div style="font-size:13px; margin-bottom:8px; opacity:0.9;">üìÖ –ü–ª–∞–Ω–æ–≤—ã–µ –ø—Ä–∏–≤–∏–≤–∫–∏:</div>';
                    plannedVaccines.forEach(v => {
                        plannedHtml += `
                            <div class="planned-vaccine-item">
                                <span>${v.name}</span>
                                <span>${new Date(v.date).toLocaleDateString()}</span>
                            </div>
                        `;
                    });
                    plannedContainer.innerHTML = plannedHtml;
                } else {
                    plannedContainer.innerHTML = '<div style="font-size:13px;">üìÖ –ù–µ—Ç –ø–ª–∞–Ω–æ–≤—ã—Ö –ø—Ä–∏–≤–∏–≤–æ–∫</div>';
                }
            } else {
                // –†–µ–∂–∏–º "–í—Å–µ" - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–±–µ–Ω–∫–∞
                statsHeader.style.display = 'none';
                allChildrenContainer.style.display = 'block';
                
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                
                let allChildrenHtml = '';
                
                children.forEach((child, childIndex) => {
                    const childEntries = entries.filter(e => e.childIndex === childIndex);
                    const lastEntry = childEntries.sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                    
                    // –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
                    let temp = '36.6¬∞C';
                    let state = '–ó–¥–æ—Ä–æ–≤';
                    let weight = child.weight ? child.weight + ' –∫–≥' : '--';
                    
                    if (lastEntry) {
                        temp = (lastEntry.temps?.day3?.to || lastEntry.temps?.day2?.to || lastEntry.temps?.day1?.to || '36.6') + '¬∞C';
                        state = lastEntry.isHealthy ? '‚úÖ –ó–¥–æ—Ä–æ–≤' : (lastEntry.title || '–ë–æ–ª–µ–µ—Ç');
                        weight = lastEntry.weight ? lastEntry.weight + ' –∫–≥' : (child.weight || '--') + ' –∫–≥';
                    }
                    
                    // –î–Ω–∏ –±–æ–ª–µ–∑–Ω–∏ –∑–∞ 30 –¥–Ω–µ–π
                    const recentEntries = childEntries.filter(e => new Date(e.date) > thirtyDaysAgo);
                    const symptomDays = new Set();
                    recentEntries.forEach(e => {
                        if (e.temps) {
                            const hasFever = 
                                (e.temps.day1?.to && parseFloat(e.temps.day1.to) > 37) ||
                                (e.temps.day2?.to && parseFloat(e.temps.day2.to) > 37) ||
                                (e.temps.day3?.to && parseFloat(e.temps.day3.to) > 37) ||
                                e.tempMoreThan3;
                            
                            if (hasFever) {
                                symptomDays.add(new Date(e.date).toDateString());
                            }
                        }
                    });
                    
                    allChildrenHtml += `
                        <div class="child-stats-row">
                            <span class="child-name">${child.name}</span>
                            <div class="child-stat-items">
                                <div class="child-stat">
                                    <div class="child-stat-label">–¢–µ–º–ø.</div>
                                    <div>${temp}</div>
                                </div>
                                <div class="child-stat">
                                    <div class="child-stat-label">–°–æ—Å—Ç–æ—è–Ω–∏–µ</div>
                                    <div>${state}</div>
                                </div>
                                <div class="child-stat">
                                    <div class="child-stat-label">–í–µ—Å</div>
                                    <div>${weight}</div>
                                </div>
                                <div class="child-stat">
                                    <div class="child-stat-label">–ë–æ–ª–µ–µ—Ç</div>
                                    <div>${symptomDays.size} –¥–Ω.</div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                allChildrenContainer.innerHTML = allChildrenHtml;
                
                // –ü–ª–∞–Ω–æ–≤—ã–µ –ø—Ä–∏–≤–∏–≤–∫–∏ –¥–ª—è –≤—Å–µ—Ö –¥–µ—Ç–µ–π - –∫–∞–∂–¥–∞—è –ø—Ä–∏–≤–∏–≤–∫–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
                const plannedVaccines = vaccines.filter(v => v.status === 'planned')
                    .sort((a, b) => new Date(a.date) - new Date(b.date));
                
                const plannedContainer = document.getElementById('plannedVaccines');
                if (plannedVaccines.length > 0) {
                    let plannedHtml = '<div style="font-size:13px; margin-bottom:8px; opacity:0.9;">üìÖ –ü–ª–∞–Ω–æ–≤—ã–µ –ø—Ä–∏–≤–∏–≤–∫–∏:</div>';
                    plannedVaccines.forEach(v => {
                        const child = children[v.childIndex]?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                        plannedHtml += `
                            <div class="planned-vaccine-item">
                                <span>${child}: ${v.name}</span>
                                <span>${new Date(v.date).toLocaleDateString()}</span>
                            </div>
                        `;
                    });
                    plannedContainer.innerHTML = plannedHtml;
                } else {
                    plannedContainer.innerHTML = '<div style="font-size:13px;">üìÖ –ù–µ—Ç –ø–ª–∞–Ω–æ–≤—ã—Ö –ø—Ä–∏–≤–∏–≤–æ–∫</div>';
                }
            }
        }

        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥ - –ò–°–ü–†–ê–í–õ–ï–ù–û!
        function updateStats() {
            const startDate = new Date(document.getElementById('periodStart').value);
            const endDate = new Date(document.getElementById('periodEnd').value);
            endDate.setHours(23, 59, 59);
            
            let filteredEntries = entries.filter(e => {
                const entryDate = new Date(e.date);
                return entryDate >= startDate && entryDate <= endDate;
            });
            
            if (selectedChild !== 'all') {
                filteredEntries = filteredEntries.filter(e => e.childIndex === selectedChild);
            }
            
            const diagnosisCount = {};
            const antibioticsList = [];
            const illnessSet = new Set(); // –î–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π
            
            filteredEntries.forEach(e => {
                // –°—á–∏—Ç–∞–µ–º –±–æ–ª–µ–∑–Ω–∏ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ –¥–∞—Ç–µ –∏ –¥–∏–∞–≥–Ω–æ–∑—É)
                if (e.title && e.title !== '–û—Å–º–æ—Ç—Ä') {
                    // –í —Ä–µ–∂–∏–º–µ "–í—Å–µ" - —É—á–∏—Ç—ã–≤–∞–µ–º —Ä–µ–±–µ–Ω–∫–∞ + –¥–∞—Ç—É + –¥–∏–∞–≥–Ω–æ–∑
                    // –í —Ä–µ–∂–∏–º–µ –æ–¥–Ω–æ–≥–æ —Ä–µ–±–µ–Ω–∫–∞ - —É—á–∏—Ç—ã–≤–∞–µ–º –¥–∞—Ç—É + –¥–∏–∞–≥–Ω–æ–∑
                    const key = (selectedChild === 'all' ? e.childIndex + '_' : '') + 
                                new Date(e.date).toDateString() + '_' + e.title;
                    illnessSet.add(key);
                    
                    // –î–ª—è —Å–ø–∏—Å–∫–∞ –¥–∏–∞–≥–Ω–æ–∑–æ–≤
                    const diagKey = e.title + (selectedChild === 'all' ? '_' + e.childIndex : '');
                    diagnosisCount[diagKey] = {
                        name: e.title,
                        child: children[e.childIndex]?.name,
                        count: (diagnosisCount[diagKey]?.count || 0) + 1
                    };
                }
                
                // –ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏
                if (e.medicines) {
                    e.medicines.forEach(m => {
                        if (m.isAntibiotic) {
                            antibioticsList.push({
                                name: m.name,
                                child: children[e.childIndex]?.name,
                                date: e.date
                            });
                        }
                    });
                }
            });
            
            // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–æ–ª–µ–∑–Ω–µ–π = —Ä–∞–∑–º–µ—Ä Set'–∞ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è–º–∏
            document.getElementById('totalIllnesses').innerHTML = illnessSet.size;
            document.getElementById('totalAntibiotics').innerHTML = antibioticsList.length;
            
            // –î–∏–∞–≥–Ω–æ–∑—ã - –∫–∞–∂–¥—ã–π –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
            let diagnosisHtml = '';
            Object.values(diagnosisCount).forEach(d => {
                diagnosisHtml += `
                    <div class="diagnosis-item">
                        <span class="diagnosis-name">${d.name} ${selectedChild === 'all' ? '¬∑ ' + d.child : ''}</span>
                        <span class="diagnosis-count">${d.count}</span>
                    </div>
                `;
            });
            document.getElementById('diagnosisList').innerHTML = diagnosisHtml || '<div class="diagnosis-item">–ù–µ—Ç –¥–∏–∞–≥–Ω–æ–∑–æ–≤</div>';
            
            // –ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏ - –∫–∞–∂–¥—ã–π –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
            antibioticsList.sort((a, b) => new Date(b.date) - new Date(a.date));
            document.getElementById('antibioticsList').innerHTML = antibioticsList.length ?
                antibioticsList.map(a => `
                    <div class="diagnosis-item">
                        <span class="diagnosis-name">${a.name} ${selectedChild === 'all' ? '¬∑ ' + a.child : ''}</span>
                        <span class="diagnosis-count">${new Date(a.date).toLocaleDateString()}</span>
                    </div>
                `).join('') :
                '<div class="diagnosis-item">–ù–µ—Ç –∞–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–æ–≤</div>';
            
            document.getElementById('statsPeriod').innerHTML = 
                `üìÖ ${startDate.toLocaleDateString()} - ${endDate.toLocaleDateString()}`;
            
            updateIllnessHistory();
        }

        // –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —Å –ø–æ–∏—Å–∫–æ–º
        function updateIllnessHistory() {
            const container = document.getElementById('illnessHistory');
            const search = document.getElementById('searchInput')?.value.toLowerCase() || '';
            
            let filteredEntries = entries;
            if (selectedChild !== 'all') {
                filteredEntries = entries.filter(e => e.childIndex === selectedChild);
            }
            
            // –ü–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –≤ –∏—Å—Ç–æ—Ä–∏–∏
            if (search) {
                filteredEntries = filteredEntries.filter(e => 
                    (e.title && e.title.toLowerCase().includes(search)) ||
                    (e.prescription && e.prescription.toLowerCase().includes(search)) ||
                    (e.medicines && e.medicines.some(m => m.name.toLowerCase().includes(search)))
                );
            }
            
            if (filteredEntries.length === 0) {
                container.innerHTML = '<div style="color:#8E8E93; text-align:center; padding:30px;">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>';
                return;
            }
            
            const sortedEntries = filteredEntries.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            let illnessHtml = '';
            sortedEntries.forEach(e => {
                const child = children[e.childIndex]?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                const date = new Date(e.date).toLocaleDateString();
                
                let tempsHtml = '';
                if (e.temps) {
                    const temps = [];
                    if (e.temps.day1?.to && parseFloat(e.temps.day1.to) > 36.6) {
                        temps.push(`<span class="history-temp-item">1–π: ${e.temps.day1.to}¬∞C</span>`);
                    }
                    if (e.temps.day2?.to && parseFloat(e.temps.day2.to) > 36.6) {
                        temps.push(`<span class="history-temp-item">2–π: ${e.temps.day2.to}¬∞C</span>`);
                    }
                    if (e.temps.day3?.to && parseFloat(e.temps.day3.to) > 36.6) {
                        temps.push(`<span class="history-temp-item">3–π: ${e.temps.day3.to}¬∞C</span>`);
                    }
                    if (e.tempMoreThan3) {
                        temps.push(`<span class="history-temp-item">üî• –µ—â–µ ${e.tempDaysCount || '?'}</span>`);
                    }
                    if (temps.length) {
                        tempsHtml = `<div class="history-temps">${temps.join('')}</div>`;
                    }
                }
                
                let medicinesHtml = '';
                if (e.medicines?.length) {
                    const meds = e.medicines.map(m => 
                        `${m.name} ${m.isAntibiotic ? 'üíä' : ''}`
                    ).join(', ');
                    medicinesHtml = `<div class="history-medicines">üíä ${meds}</div>`;
                }
                
                let prescriptionHtml = '';
                if (e.prescription) {
                    prescriptionHtml = `<div class="history-prescription">üìã ${e.prescription}</div>`;
                }
                
                illnessHtml += `
                    <div class="history-item">
                        <div class="history-actions">
                            <button class="history-edit-btn" onclick="editEntry(${e.id})">‚úèÔ∏è</button>
                            <button class="history-delete-btn" onclick="deleteEntry(${e.id})">üóëÔ∏è</button>
                        </div>
                        <div class="history-header">
                            <span class="history-name">${e.title || '–û—Å–º–æ—Ç—Ä'}</span>
                            <span class="history-child">${child}</span>
                        </div>
                        <div class="history-date">${date}</div>
                        ${e.recoveryDate ? `<div class="history-recovery">‚ú® –í—ã–∑–¥–æ—Ä–æ–≤–ª–µ–Ω–∏–µ: ${new Date(e.recoveryDate).toLocaleDateString()}</div>` : ''}
                        ${e.weight ? `<div class="history-date">‚öñÔ∏è –í–µ—Å: ${e.weight} –∫–≥</div>` : ''}
                        ${tempsHtml}
                        ${medicinesHtml}
                        ${prescriptionHtml}
                    </div>
                `;
            });
            container.innerHTML = illnessHtml;
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ
        function deleteEntry(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')) {
                entries = entries.filter(e => e.id !== id);
                saveData();
                updateAll();
                showMessage('üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ');
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        function saveData() {
            localStorage.setItem('children', JSON.stringify(children));
            localStorage.setItem('entries', JSON.stringify(entries));
            localStorage.setItem('pharmacy', JSON.stringify(pharmacy));
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ–≥–æ
        function updateAll() {
            updateCurrentStats();
            updatePharmacy();
            updateVaccineHistory();
            updateStats();
        }

        // –°–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = text;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // –≠–∫—Å–ø–æ—Ä—Ç
        function exportCSV() {
            let csv = '–î–∞—Ç–∞;–†–µ–±–µ–Ω–æ–∫;–î–∏–∞–≥–Ω–æ–∑;–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 1–π;–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 2–π;–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 3–π;–í–µ—Å;–í—ã–∑–¥–æ—Ä–æ–≤–ª–µ–Ω–∏–µ;–ù–∞–∑–Ω–∞—á–µ–Ω–∏—è;–õ–µ–∫–∞—Ä—Å—Ç–≤–∞\n';
            entries.forEach(e => {
                const child = children[e.childIndex]?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                const antibiotics = e.medicines?.filter(m => m.isAntibiotic).map(m => m.name).join(', ') || '';
                csv += `"${new Date(e.date).toLocaleString()}";"${child}";"${e.title || ''}";"${e.temps?.day1?.to || ''}";"${e.temps?.day2?.to || ''}";"${e.temps?.day3?.to || ''}";"${e.weight || ''}";"${e.recoveryDate || ''}";"${e.prescription || ''}";"${antibiotics}"\n`;
            });
            
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'health.csv';
            link.click();
        }

        function exportJSON() {
            const data = { children, entries, pharmacy, vaccines };
            const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'backup.json';
            link.click();
        }

        // –ó–∞–ø—É—Å–∫
        init();
    </script>
    
    <!-- Service Worker –¥–ª—è PWA -->
    <script>
        // –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—Å—Ç service-worker.js –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'health-cache-v1';
                    
                    self.addEventListener('install', event => {
                        self.skipWaiting();
                    });
                    
                    self.addEventListener('activate', event => {
                        event.waitUntil(clients.claim());
                    });
                    
                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => {
                                    if (response) {
                                        return response;
                                    }
                                    return fetch(event.request).then(response => {
                                        if (!response || response.status !== 200 || response.type !== 'basic') {
                                            return response;
                                        }
                                        const responseToCache = response.clone();
                                        caches.open(CACHE_NAME).then(cache => {
                                            cache.put(event.request, responseToCache);
                                        });
                                        return response;
                                    });
                                })
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const url = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(url)
                    .then(reg => console.log('‚úÖ PWA ready for offline use'))
                    .catch(err => console.log('PWA works without service worker'));
            });
        }
    </script>
</body>
</html>
